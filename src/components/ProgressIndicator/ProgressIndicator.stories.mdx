import { Meta, Story, Preview, Props } from '@storybook/addon-docs';
import { select, number, boolean, withKnobs } from '@storybook/addon-knobs';

import ProgressIndicator from './ProgressIndicator';
import Typography from '../Typography';
import Stack from '../storyUtils/Stack';
import { FIGMA_URL, Function } from '../../utils/common';
import { useState, useEffect } from 'react';
import SectionHeader from '../../storybook/SectionHeader';

<Meta
  title="Design System/Progress Indicator"
  component={ProgressIndicator}
  parameters={{
    design: [
      {
        type: 'figma',
        name: 'ProgressIndicator',
        url: `${FIGMA_URL}?node-id=10283%3A104361`,
      },
    ],
  }}
/>

<SectionHeader title={'Progress Indicator'} />

- [Overview](#overview)
- [Props](#props)
- [Usage](#usage)
- [Variants](#variants)

## Overview

Progress indicators communicate to the user the current progress of a given task.

## Props

<Props of={ProgressIndicator} />

## Usage

<UsageGuidelines
  guidelines={[
    'Use determinate indicators when you can display how long a process will take',
    'Use indeterminate indicators when progress of a given task is not detectable',
    'Use indeterminate indicators when progress of a given task is very fast (under 2s)',
    'When you need to indicate progress for all instances of a given process (e.g. file upload)',
    'When submitting a form or saving updates (appears on top of the screen)',
  ]}
  policies={[
    'Do not use progress indicators as visual decoration. Create a custom component instead',
    'Do not use progress indicators as data visualization. Create a custom component instead or use an existing chart, if available',
  ]}
/>

## Variants

### Linear Progress Indicator with percentage

The `value` prop, if provided, makes the progress indicator determinate.

<Preview>
  <Story name="Linear Progress Indicator with percentage">
    <Stack width={300}>
      <Function>
        {() => {
          const [value, setValue] = useState(0);
          useEffect(() => {
            const interval = setInterval(
              () =>
                setValue((value) => {
                  if (value + 20 > 100) return 0;
                  return value + 20;
                }),
              1000
            );
            return () => {
              clearInterval(interval);
            };
          }, []);
          return (
            <div
              style={{
                display: 'flex',
                gap: '32px',
                alignItems: 'center',
                flexDirection: 'column',
              }}
            >
              <ProgressIndicator value={value} />
              <Typography variant="body03">Loading: {value}%</Typography>
            </div>
          );
        }}
      </Function>
    </Stack>
  </Story>
</Preview>

### Linear Progress Indicator - Indeterminate

If the `value` prop is not provided, the progress indicator becomes indeterminate.

<Preview>
  <Story name="Linear Progress Indicator - Indeterminate">
    <Stack width={300}>
      <ProgressIndicator />
    </Stack>
  </Story>
</Preview>

### Linear Progress Indicator - Border Radius

For the linear indicator, the border-radius of the outer bar can be deactivated, in case e.g. the progress indicator is rendered inside a container.

<Preview>
  <Story name="Linear Progress Indicator - Border Radius">
    <Stack width={300} isVertical>
      <ProgressIndicator />
      <div
        style={{
          border: '1px solid #B9C0FF',
          height: '24px',
          display: 'flex',
          alignItems: 'center',
        }}
      >
        <ProgressIndicator hasBorderRadius={false} />
      </div>
    </Stack>
  </Story>
</Preview>

### Circular Progress Indicator with percentage

<Preview>
  <Story name="Circular Progress Indicator with percentage">
    <Stack>
      <Function>
        {() => {
          const [value, setValue] = useState(0);
          useEffect(() => {
            const interval = setInterval(
              () =>
                setValue((value) => {
                  if (value + 20 > 100) return 0;
                  return value + 20;
                }),
              1000
            );
            return () => {
              clearInterval(interval);
            };
          }, []);
          return (
            <div style={{ display: 'flex', gap: '32px', alignItems: 'center' }}>
              <ProgressIndicator type={'circle'} value={value} />
              <Typography variant="body03">Loading: {value}%</Typography>
            </div>
          );
        }}
      </Function>
    </Stack>
  </Story>
</Preview>

### Circular Progress Indicator - Indeterminate

<Preview>
  <Story name="Circular Progress Indicator - Indeterminate">
    <Stack>
      <ProgressIndicator type={'circle'} />
    </Stack>
  </Story>
</Preview>

### Circular Progress Indicator - Error States

The status of the progress indicator can be `normal` or `error`.

<Preview>
  <Story name="Circular Progress Indicator - Error States">
    <Stack>
      <ProgressIndicator type={'circle'} value={60} status="error" />
    </Stack>
    <Stack width={300}>
      <ProgressIndicator value={60} status="error" />
    </Stack>
  </Story>
</Preview>

### Playground

<Preview>
  <Story name="Playground" parameters={{ decorators: [withKnobs] }}>
    <Stack width={300} isVertical>
      <ProgressIndicator
        type={select('type', ['linear', 'circular'], 'linear')}
        status={select('status', ['normal', 'error'], 'normal')}
        hasBorderRadius={boolean('hasBorderRadius [for linear only]', true)}
      />
      <ProgressIndicator
        value={number('value', undefined)}
        type={select('type', ['linear', 'circular'], 'linear')}
        status={select('status', ['normal', 'error'], 'normal')}
        hasBorderRadius={boolean('hasBorderRadius [for linear only]', true)}
      />
    </Stack>
  </Story>
</Preview>
