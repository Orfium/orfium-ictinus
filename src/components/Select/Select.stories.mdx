import { Meta, Story, Preview, Props } from '@storybook/addon-docs';
import { withKnobs, boolean, array, select, text } from '@storybook/addon-knobs';
import Select from './Select';
import Stack from '../storyUtils/Stack';
import { SelectShowcase, MultiSelectShowcase } from '../storyUtils/SelectShowcase';
import EdgeCasesSelectShowcase from '../storyUtils/EdgeCasesSelectShowcase';
import { FIGMA_URL, Function } from '../../utils/common';
import { useState } from 'react';
import { StatefulSelect } from './index';
import { options, optionsWithHelperInDisabled, groupOptions, defaultValue } from './constants';
import Overview from '../../storybook/Overview';

<Meta
  title="Updated Components/Fields/Select"
  component={Select}
  parameters={{
    design: [
      {
        type: 'figma',
        name: 'Select',
        url: `${FIGMA_URL}?node-id=10019%3A116506`,
      },
      {
        type: 'figma',
        name: 'Active',
        url: `${FIGMA_URL}?node-id=10019%3A116507`,
      },
      {
        type: 'figma',
        name: 'Edge cases',
        url: `${FIGMA_URL}?node-id=1879%3A101`,
      },
    ],
  }}
/>

<SectionHeader title={'Select'} />

- [Overview](#overview)
- [Props](#props)
- [Usage](#usage)
- [Variants](#variants)

## Overview

<Story
  name="Overview"
  parameters={{
    previewTabs: {
      canvas: { hidden: true },
    },
  }}
>
  <Overview>
    A universal Select component that is a clickable element that can hold many forms.
  </Overview>
</Story>

## Props

<Props of={Select} />

## Usage

<UsageGuidelines
  guidelines={[
    'If you need to select and enter an item from a dropdown list that features more than seven items, use searchable select.',
    'If you need to be able to enter free text entry in addition to choosing form a predefined list, use searchable select',
    'If you need to enter more than one values from a predefined list, use multiselect',
  ]}
/>

<SubsectionHeader title="Variants" />

### Simple Select

<Preview>
  <Story name="Simple Select">
    <Stack height={350}>
      <Function>
        {() => {
          const [selectedOption, setSelectedOption] = useState(defaultValue);
          return (
            <Select
              isSearchable={false}
              selectedOption={selectedOption}
              onChange={setSelectedOption}
              label={'Select'}
              options={options}
            />
          );
        }}
      </Function>
    </Stack>
  </Story>
</Preview>

### Searchable Select

<Preview>
  <Story name="Searchable Select">
    <Stack height={300}>
      <Function>
        {() => {
          const [selectedOption, setSelectedOption] = useState(defaultValue);
          return (
            <Select
              label={'Select'}
              options={options}
              selectedOption={selectedOption}
              onChange={setSelectedOption}
              isCreatable={boolean('isCreatable', false)}
              isVirtualized={boolean('isVirtualized', true)}
            />
          );
        }}
      </Function>
    </Stack>
  </Story>
</Preview>

### Select with uncontrolled state

<Preview>
  <Story name="Select with uncontrolled state" parameters={{ decorators: [withKnobs] }}>
    <Stack height={350}>
      <StatefulSelect
        label={'Select'}
        status={{
          type: 'normal',
          hintMessage: text(
            'Custom Hint Message',
            'This is a select with uncontrolled value, see code for more'
          ),
        }}
        options={options}
        selectedOption={defaultValue}
      />
    </Stack>
  </Story>
</Preview>

### Simple Select with Groups

Simple select component with grouped data and searchable input

<Preview>
  <Story name="Simple Select with Groups">
    <Stack height={350}>
      <Function>
        {() => {
          const [selectedOption, setSelectedOption] = useState(defaultValue);
          return (
            <Select
              label={'Group Select'}
              hasHighlightSearch
              selectedOption={selectedOption}
              onChange={setSelectedOption}
              options={groupOptions}
            />
          );
        }}
      </Function>
    </Stack>
  </Story>
</Preview>

### Select with Async Search

Select that support asynchronous fetching, with loading status

<Preview>
  <Story name="Select with Async Search">
    <SelectShowcase />
  </Story>
</Preview>

### Select with edge case

Select cases where it gets to minimum and maximum width based on options <br />

1. max width of floating menu to 620 and then ellipsis <br />
2. max width with smaller floating menu content that set to max
3. min size (150px) for both

<Preview>
  <Story name="Select with edge case">
    <EdgeCasesSelectShowcase />
  </Story>
</Preview>

### MultiSelect

A Select component with multiple selected options represented as Chips. <br/>

_. To initiate a MultiSelect, the `multi` prop must be set to `true`
_. In this variation the props: `leftIcon` and `size` are deprecated (`size` is always set to `md` by default). <br/>
_. Instead of the `selectedOption` prop we now use the `selectedOptions` prop (with type: `SelectOption[]`) .
_. When in MultiSelect, `onClear` prop refers to the all selected options deletion and `onOptionDelete` prop refers to single option deletion

<Preview>
  <Story name="MultiSelect">
    <MultiSelectShowcase
      isDisabled={boolean('isDisabled', false)}
      status={{
        type: select('Status', ['error', 'normal', 'read-only'], 'normal'),
        hintMessage: text('Hint/Error message', 'Message in Text Field'),
      }}
      hasSelectAllOption={boolean('hasSelectAllOption', false)}
      isCreatable={boolean('isCreatable', false)}
    />
  </Story>
</Preview>

### Select Statuses

Select with Statuses

<Preview>
  <Story name="Select Statuses" parameters={{ decorators: [withKnobs] }}>
    <Stack height={350}>
      <Function>
        {() => {
          const [selectedOption, setSelectedOption] = useState(defaultValue);
          return (
            <Select
              label={'Normal'}
              status={{
                type: 'normal',
                hintMessage: text('Custom Hint Message', 'Hint Message'),
              }}
              options={options}
              selectedOption={selectedOption}
              onChange={setSelectedOption}
              isCreatable={boolean('isCreatable', false)}
              isVirtualized={boolean('isVirtualized', true)}
            />
          );
        }}
      </Function>
      <Function>
        {() => {
          const [selectedOption, setSelectedOption] = useState(defaultValue);
          return (
            <Select
              label={'Error'}
              status={{
                type: 'error',
                hintMessage: text('Custom Error Message', 'Error Message'),
              }}
              options={options}
              selectedOption={selectedOption}
              onChange={setSelectedOption}
              isCreatable={boolean('isCreatable', false)}
              isVirtualized={boolean('isVirtualized', true)}
            />
          );
        }}
      </Function>
      <Function>
        {() => {
          const [selectedOption, setSelectedOption] = useState(defaultValue);
          return (
            <Select
              label={'Read-only'}
              status={{
                type: 'read-only',
                hintMessage: text('Custom Hint Message', 'Hint Message'),
              }}
              options={options}
              selectedOption={selectedOption}
              onChange={setSelectedOption}
              isCreatable={boolean('isCreatable', false)}
              isVirtualized={boolean('isVirtualized', true)}
            />
          );
        }}
      </Function>
    </Stack>
  </Story>
</Preview>

### Disabled Select

Select disabled with label

<Preview>
  <Story name="Disabled Select">
    <Stack>
      <Select
        isDisabled
        label={'Select'}
        options={options}
        status={{ type: 'normal', hintMessage: 'This field is disabled' }}
      />
    </Stack>
  </Story>
</Preview>

### Playground

<Preview>
  <Story name="Playground">
    <Stack height={350}>
      <Function>
        {() => {
          const [selectedOption, setSelectedOption] = useState(defaultValue);
          return (
            <Select
              label={text('Label', 'Select')}
              status={{
                type: select('Status', ['error', 'normal', 'read-only'], 'normal'),
                hintMessage: text('Hint/Error message', 'Message in Text Field'),
              }}
              isSearchable={boolean('isSearchable', false)}
              isDisabled={boolean('isDisabled', false)}
              options={options}
              selectedOption={selectedOption}
              onChange={setSelectedOption}
            />
          );
        }}
      </Function>
    </Stack>
  </Story>
</Preview>
